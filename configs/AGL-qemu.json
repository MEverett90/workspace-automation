{
    "id": "AGL-qemu",
    "load": false,
    "supported_archs": ["x86_64"],
    "supported_host_types": ["ubuntu"],
    "flutter_runtime": "debug",
    "type": "qemu",
    "env": {
        "FLUTTER_DEBUG_PORT": "1234",
        "FLUTTER_OBSERVATORY_HOST": "0.0.0.0",
        "CONTAINER_SSH_PORT": "2222",
    },
    "runtime": {
        "config": {
            "window_type": "BG",
            "width": 1920,
            "height": 1080,
            "fullscreen": true
        },
        "install_dependent_packages": true,
        "artifact_source": "github",
        "github_owner": "meta-flutter",
        "github_repo": "meta-flutter",
        "github_workflow": "kirkstone-agl-${MACHINE_ARCH}.yml",
        "github_artifact": "agl-image-flutter-runtime${FLUTTER_RUNTIME}-qemu${MACHINE_ARCH_HYPHEN}-linux",
        "cmd": "qemu-system-${FORMAL_MACHINE_ARCH}",
        "args_x86_64": "-m 2048 ${QEMU_EXTRA} -hda ${QEMU_IMAGE} -cpu kvm64 -cpu qemu64,+ssse3,+sse4.1,+sse4.2,+popcnt -vga virtio -device virtio-rng-pci -serial mon:stdio -serial null -soundhw hda -device virtio-net-pci,netdev=net0,mac=${RANDOM_MAC} -netdev user,id=net0,hostfwd=tcp::${CONTAINER_SSH_PORT}-:22,hostfwd=tcp::${FLUTTER_DEBUG_PORT}-:${FLUTTER_DEBUG_PORT}",
        "qemu_image_x86_64": ".agl/agl-image-flutter-runtime${FLUTTER_RUNTIME}-qemux86-64.wic.vmdk",
        "args_arm64": "-accel hvf -cpu host -M virt ${QEMU_EXTRA} -m 4096 -device virtio-gpu-pci -nographic -display cocoa,show-cursor=on -object rng-random,filename=/dev/urandom,id=rng0 -device virtio-rng-pci,rng=rng0 -device qemu-xhci -device usb-tablet -device usb-mouse -device usb-kbd -device virtio-net-pci,netdev=vnet -netdev user,id=vnet,hostfwd=tcp::${CONTAINER_SSH_PORT}-:22,hostfwd=tcp::${FLUTTER_DEBUG_PORT}-:${FLUTTER_DEBUG_PORT} -kernel ${KERNEL} -drive file=${QEMU_IMAGE},format=raw,if=virtio -append root=/dev/vda",
        "kernel_arm64": ".agl/Image-qemuarm64.bin",
        "qemu_image_arm64": ".agl/agl-image-flutter-runtime${FLUTTER_RUNTIME}-qemuarm64.ext4",
        "qemu_extra_darwin": "-smp cpus=8,sockets=1,cores=8,threads=1",
        "qemu_extra_ubuntu": "-bios OVMF.fd",
        "qemu_extra_fedora": "-bios /usr/share/edk2/ovmf/OVMF_CODE.fd"
    },
    "overwrite-existing": true,
    "custom-device": {
        "id": "AGL-qemu",
        "label": "AGL ${MACHINE_ARCH} QEMU Image",
        "sdkNameAndVersion": "agl-image-flutter-runtime${FLUTTER_RUNTIME}-qemu${MACHINE_ARCH_HYPHEN}",
        "platform": "linux-x64",
        "enabled": true,
        "ping": "bash -c (echo >/dev/tcp/localhost/${CONTAINER_SSH_PORT}) &>/dev/null && echo \"open ${CONTAINER_SSH_PORT}\" || echo \"close ${CONTAINER_SSH_PORT}\"",
        "pingSuccessRegex": "open ${CONTAINER_SSH_PORT}",
        "postBuild": "bash -c mkdir -p ${localPath}/../../.flutter-auto/data/flutter_assets && cp -r ${localPath}/* ${localPath}/../../.flutter-auto/data/flutter_assets && cp -r ${FLUTTER_WORKSPACE}/.agl/default_config.json ${localPath}/../../.flutter-auto/ && ssh -p ${CONTAINER_SSH_PORT} -t -oBatchMode=yes root@localhost passwd -d agl-driver",
        "uninstall": "bash -c ssh -p ${CONTAINER_SSH_PORT} -t -t -oBatchMode=yes agl-driver@localhost rm -rf \"/tmp/${appName}\"",
        "install": "bash -c ssh -p ${CONTAINER_SSH_PORT} -t -t -oBatchMode=yes agl-driver@localhost mkdir -p \"/tmp/${appName}/data/flutter_assets\" && scp -r -P ${CONTAINER_SSH_PORT} ${localPath}/../../.flutter-auto/* agl-driver@localhost:/tmp/${appName}",
        "runDebug": "ssh -t -t -p ${CONTAINER_SSH_PORT} -oBatchMode=yes agl-driver@localhost flutter-auto --j=/tmp/${appName}/default_config.json --b=/tmp/${appName} --observatory-host=${FLUTTER_OBSERVATORY_HOST} --observatory-port=${FLUTTER_DEBUG_PORT}",
        "forwardPort": null,
        "forwardPortSuccessRegex": null,
        "screenshot": null
    }
}
